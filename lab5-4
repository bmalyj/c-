#include <iostream>
#include <future>
#include <random>
#include <vector>
#include <stdexcept>

class PiCalculator {
public:
    // Вычисление π с использованием заданного количества точек
    double calculatePiPortion(int total_points) {
        // TODO: Реализовать метод Монте-Карло для части вычислений

        if (total_points <= 0) {
            throw std::runtime_error("Количество точек должно быть положительным");
        }

        std::random_device rd;
        std::mt19937 gen(rd());
        std::uniform_real_distribution<double> dist(0.0, 1.0);

        int inside_circle = 0;

        for (int i = 0; i < total_points; ++i) {
            double x = dist(gen);
            double y = dist(gen);

            // Проверяем, попала ли точка в четверть круга
            if (x * x + y * y <= 1.0) {
                inside_circle++;
            }
        }

        // π ≈ 4 * (количество точек в круге / общее количество точек)
        return 4.0 * inside_circle / total_points;
    }

    // Параллельное вычисление π
    double calculatePiParallel(int total_points, int num_tasks) {
        std::vector<std::future<double>> futures;
        int points_per_task = total_points / num_tasks;

        // TODO: Создать асинхронные задачи
        for (int i = 0; i < num_tasks; ++i) {
            futures.push_back(
                std::async(
                    std::launch::async,
                    &PiCalculator::calculatePiPortion,
                    this,
                    points_per_task
                )
            );
        }

        double sum = 0.0;

        // TODO: Собрать и усреднить результаты
        try {
            for (auto& f : futures) {
                sum += f.get(); // Получаем результат задачи
            }
        } catch (const std::exception& e) {
            std::cerr << "Ошибка вычислений: " << e.what() << std::endl;
            return 0.0;
        }

        return sum / num_tasks; // Усреднение результатов
    }
};

int main() {
    PiCalculator calculator;

    int total_points = 10'000'000;
    int num_tasks = 4;

    double pi = calculator.calculatePiParallel(total_points, num_tasks);

    std::cout << "Приближенное значение pi: " << pi << std::endl;
    return 0;
}
